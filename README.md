# DWM Dump Viewer

版本：v0.2 
作者：0raN9e

## 简介
DWM Dump Viewer 是一个用于从 `dwm.exe.dmp` 中尝试解析并可视化图像的桌面工具。它支持设置分辨率与 `pitch`、图像格式（RGB/RGBA/BGR/BGRA/Luma）、偏移滑块与字节步长，并提供两种批量导出模式：一键爆破与均匀采样。支持拖拽 `.dmp` 到窗口打开、自动播放偏移滑块、以及将高级选项折叠到图像下方的区域，简化主界面。

## 功能亮点
- 打开 dump 并在指定偏移处解析、预览图像（支持 RGB/BGR/RGBA/BGRA/灰度）。
- 自动播放偏移滑块：按设定间隔与步长循环预览序列画面。
- 一键爆破导出：按固定步进遍历偏移并计算评分，仅导出达到阈值的高分结果（RGBA/BGRA）。
- 均匀采样导出：在全偏移范围内等间距选取 N 个样本（默认 200），不做评分过滤（RGBA/BGRA）。
- 自动扫描（局部/全局）：在邻近范围或全文件内快速搜索有较好得分的候选参数（RGBA/BGRA）。
- 仅对齐位置：根据对齐块（默认等同于滑块步长）约束偏移，保证读取安全与速度。
- 适应窗口显示、强制 Alpha=255、拖拽 `.dmp` 文件打开。

## 核心概念
- 偏移滑块：数值表示“块索引”，实际偏移 = 块索引 × 滑块步长（字节）。
- 可读范围：自动约束到 `file_size - max(rowbytes, pitch) * height`，避免越界读取。
- 评分：用于衡量导出图像的清晰度/对比度，爆破模式用于筛选，高分更倾向于“像样”的画面。

## 一键爆破 vs 均匀采样
- 一键爆破：
  - 遍历大量偏移，逐个打分，仅导出分数 ≥ 阈值的结果。
  - 导出数量不固定，受“步进字节”“阈值”影响；在某些区域可能密集，某些区域稀疏。
- 均匀采样：
  - 在 `[0, 最大偏移(slider)]` 范围内均分为 N 个采样（默认 200），不做评分过滤。
  - 导出数量固定为设定的采样张数，覆盖更均匀，代表性更强。

## 快速开始
- 环境准备：
  - 安装 Python 3.9+，在项目目录执行：`pip install -r requirements.txt`
  - 或使用打包的可执行文件（如果提供），直接运行。
- 启动：
  - 在项目目录执行：`python app.py`
- 打开 dump：
  - 点击“打开 dump”选择 `dwm.exe.dmp`，或将 `.dmp` 文件直接拖拽到窗口。
- 基础预览：
  - 设置分辨率/宽高，点击“自动计算 pitch”按 `width * bpp` 对齐（默认 256）。
  - 选择图像格式：`RGB`、`RGBA`、`BGR`、`BGRA`、`Luma`（灰度）。
  - 勾选“适应窗口”可按窗口缩放显示。
- 偏移与滑动：
  - 在“偏移”输入字节位置，或用底部“偏移滑块”快速移动。
  - “滑块步长(字节)”决定滑块每格对应的偏移增量。
  - 使用“自动播放”按设定间隔与步长循环移动滑块，便于快速预览序列。
- 高级选项（在图像下方，需勾选“显示高级选项”）：
  - 自动扫描：在局部/全文件搜索高分候选（仅支持 `RGBA/BGRA`）。
  - 一键爆破导出：遍历偏移按评分阈值导出（仅支持 `RGBA/BGRA`）。
  - 均匀采样导出：按均匀步进导出固定张数（仅支持 `RGBA/BGRA`）。
  - 仅对齐位置：按对齐块限制偏移，确保读取安全与速度。
  - 导出上限 / 采样张数：控制批量导出的数量。
- 导出：
  - 当前预览：点击“导出 PNG”保存当前画面。
  - 批量导出：输出至 `output/` 目录；退出程序自动清理该目录（也可点击“卸载镜像”手动清理）。
- 常见参数参考：
  - Windows 场景常见图像格式为 `BGRA`；`pitch ≈ width × 4`，通常按 256 对齐。
  - 若画面错位或色彩反转，可在图像格式之间切换（`RGBA/BGRA`、`RGB/BGR`、`Luma`）。

## 使用指南
- 分辨率与 pitch：
  - 选择预设或手动设置宽高；使用“自动计算 pitch”根据 `width * bpp` 对齐（默认按 256 对齐）。
- 图像格式与 Alpha：
  - 切换 `RGB/BGR/RGBA/BGRA/Luma`；启用“强制 Alpha=255”确保图像不透明显示。
- 偏移与滑块：
  - 可在偏移输入框直接填字节偏移，或通过滑块（步长可调）快速移动；支持自动播放。
- 自动扫描：
  - 在局部（±跨度）或全文件范围内寻找高分候选，自动写回最佳偏移/参数（只在 RGBA/BGRA 可用）。
- 一键爆破导出：
  - 设置步进、阈值与导出上限，导出的 PNG 文件名包含偏移、pitch、格式与评分后缀（只在 RGBA/BGRA 可用）。
- 均匀采样导出：
  - 设置“采样张数”（默认 200），在全滑块范围均匀取样并导出（只在 RGBA/BGRA 可用）。
  - 可勾选“仅对齐位置”将采样点按对齐块对齐，保证读取安全。

## 输出位置与命名
- 导出目录：`output/`
- 命名示例：`off{偏移}_pitch{pitch}_{format}_{宽}x{高}_{score}.png`（采样模式无评分则不带 score）。

## 变更与版本
- v0.2：
  - 精简为“图像格式”下拉（RGB/RGBA/BGR/BGRA/Luma），移除通道顺序控件。
  - 增加“自动播放偏移滑块”，以及拖拽 `.dmp` 打开。
  - 将高级选项移至图像下方的折叠区，主界面更简洁。
  - 导出逻辑适配灰度与三通道，评分与批量导出限定在 RGBA/BGRA。
- v0.1：初始发布；增加“均匀采样导出”、取消采样/爆破、自动扫描优化、读缓冲优化等。

